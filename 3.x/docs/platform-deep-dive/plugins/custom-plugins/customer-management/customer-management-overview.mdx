---
title: Overview
description: Customer management plugin uses a search engine (for example, [elasticSearch](https://www.elastic.co/) engine) to retrieve user details using partial match on big databases.
---

![](https://s3.eu-west-1.amazonaws.com/docx.flowx.ai/platform-deep-dive/crm-plugin.svg)

The plugin listens for incoming requests on a Kafka topic and sends the reply to the Engine on an outgoing topic.

[Kafka topics for Customer Management](#kafka-topics-for-customer-management)

## Kafka topics for customer management

### Customer Search

<Info>
The kafka topics used for the Customer Management plugin can be defined/overwritten using the following environment variables (that can be found in the deployment of the service):
* `KAFKA_TOPIC_CUSTOMER_SEARCH_IN` - used to search customers in the customer management plugin
* `KAFKA_TOPIC_CUSTOMER_SEARCH_OUT` - used to get the response from the customer management plugin to the Engine.
</Info>

## Search Capabilities

The Customer Management plugin provides powerful search functionality through Elasticsearch. You can perform searches using:

* **Exact Match**: Perfect for unique identifiers like CIF or ClientUniqueIdentifier
* **Partial Match**: Useful for names and text fields
* **Date Range**: Available for all date fields
* **Combined Search**: Multiple criteria can be used together for more precise results

### Search Configuration

The request sent to the plugin can use any key that was previously configured in the elasticsearch index where the customers are saved. The search is optimized using custom analyzers and normalizers for improved matching.

Example of an elastic search index configuration:

```json
{
  "settings": {
    "analysis": {
      "normalizer": {
        "lowercase_normalizer": {
          "type": "custom",
          "filter": ["lowercase"]
        }
      }
    }
  },
  "mappings": {
    "properties": {
      "CIF":{
        "type": "keyword",
        "normalizer": "lowercase_normalizer"
      },
      "ClientUniqueIdentifier": {
        "type": "keyword",
        "normalizer": "lowercase_normalizer"
      },
      "CNPFlex":{
        "type": "text"
      },
      "ClientType":{
        "type": "text"
      },
      "ClientCategory":{
        "type": "text"
      },
      "FirstName":{
        "type": "text",
        "fields": {
          "keyword":{
            "type": "keyword",
            "normalizer": "lowercase_normalizer"
          }
        }
      },
      "LastName":{
        "type": "text",
        "fields": {
          "keyword":{
            "type": "keyword",
            "normalizer": "lowercase_normalizer"
          }
        }
      },
      "CompanyName":{
        "type": "text",
        "fields": {
          "keyword":{
            "type": "keyword",
            "normalizer": "lowercase_normalizer"
          }
        }
      },
      "DateOfBirth":{
        "type": "date",
        "format": "dd.MM.yyyy"
      },
      "IDDocType":{
        "type": "text"
      },
      "IDSeries":{
        "type": "text"
      },
      "IDNumber":{
        "type": "text"
      },
      "IDIssueDate": {
        "type": "date",
        "format": "dd.MM.yyyy"
      },
      "IDExpiryDate":{
        "type": "date",
        "format": "dd.MM.yyyy"
      },
      "LegalForm":{
        "type": "text"
      },
      "CreatedDatePJ":{
        "type": "date",
        "format": "dd.MM.yyyy"
      },
      "ClientClosedDate": {
        "type": "date",
        "format": "dd.MM.yyyy"
      },
      "LastModifiedDate":{
        "type": "date",
        "format": "dd.MM.yyyy"
      },
      "ListID":{
        "type": "text"
      },
      "MobilePhone":{
        "type": "text"
      }
    }
  }
}
```

## Search Examples

Below are various examples demonstrating different search patterns:

### Example 1 - Simple Search by Unique Identifier
Perfect for exact matches when you know the specific identifier:

```json
{
"ClientUniqueIdentifier": "1900101223344"
}
```

### Example 2 - Combined Name Search
Useful for finding customers by their full name:

```json
{
"FirstName": "TestFirstName",
"LastName": "Test Last Name"
}
```

### Example 3 - Multi-criteria Search
Combines multiple fields for more precise results:

```json
{
"FirstName": "TestFirstName",
"DateOfBirth": "01.01.1990",
"LegalForm": "PF"
}
```

### Example 4 - Partial Name Match
The search supports partial matches for text fields:

```json
{
"FirstName": "Test",
"CompanyName": "Corp"
}
```

## Response Structure

The search response includes the following key elements:

* **customers** - Array of matching customer records (maximum 10 results)
* **hasMore** - Boolean indicator (true if more than 10 results exist)
* **error** - Error description if the request failed

### Response Fields Description:
* **id** - Unique customer identifier
* **firstName** - Customer's first name
* **lastName** - Customer's last name
* **birthDate** - Date of birth (format: dd.MM.yyyy)
* **cui** - Unique identification code
* **companyName** - Name of the company (for business customers)
* **clientCategory** - Customer category (e.g., PF, PJ)
* **clientType** - Type of client
* **idSeries**, **idNumber**, **idDocType** - ID document details
* **idExpiryDate** - ID document expiry date
* **legalForm** - Legal form of the entity
* **listId** - Internal list identifier
* **mobilePhone** - Contact number
* **attributes** - Additional customer attributes
* **type** - Customer type classification

Topic name example:

```
ro.flowx.updates.sandbox.customer.management.response
```

Example response:

```json
"searchResults" : {
    "customers" : [ {
      "id" : "CL12345",
      "firstName" : "John Doe",
      "lastName" : "Doe",
      "birthDate" : "27.02.1982",
      "cui" : "1820227103865_84",
      "companyName" : "",
      "clientCategory" : "PF",
      "clientType" : "PF",
      "idSeries" : "RT",
      "idNumber" : "879948",
      "idDocType" : "CI",
      "idExpiryDate" : "27.02.2023",
      "legalForm" : "",
      "listId" : "4691602",
      "mobilePhone" : "0711111111",
      "attributes" : null,
      "type" : "PF"}],
    "hasMore" : false,
    "error" : null
  }
```