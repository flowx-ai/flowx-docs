---
title: Overview
description: Customer management plugin uses a search engine (for example, Elasticsearch engine) to retrieve user details using partial match on big databases.
---

![](https://s3.eu-west-1.amazonaws.com/docx.flowx.ai/platform-deep-dive/crm-plugin.svg)

The Customer Management plugin provides powerful search capabilities to find and retrieve customer information from your database. It listens for incoming requests on a Kafka topic and sends the reply to the Engine on an outgoing topic.

## Search Capabilities

The plugin leverages Elasticsearch to provide:
- Partial text matching
- Case-insensitive search
- Multi-field search combinations
- Up to 10 results per query
- Normalized text handling through custom analyzers

## Kafka Topics for Customer Management

<Info>
The kafka topics used for the Customer Management plugin can be defined/overwritten using the following environment variables (that can be found in the deployment of the service):
* `KAFKA_TOPIC_CUSTOMER_SEARCH_IN` - used to search customers in the customer management plugin
* `KAFKA_TOPIC_CUSTOMER_SEARCH_OUT` - used to get the response from the customer management plugin to the Engine.
</Info>

### Search Configuration

The search functionality is built on an Elasticsearch index with specific field mappings. You can search using any configured field in the index. Here's the complete index configuration:

```json
{
  "settings": {
    "analysis": {
      "normalizer": {
        "lowercase_normalizer": {
          "type": "custom",
          "filter": ["lowercase"]
        }
      }
    }
  },
  "mappings": {
    "properties": {
      "CIF":{
        "type": "keyword",
        "normalizer": "lowercase_normalizer"
      },
      "ClientUniqueIdentifier": {
        "type": "keyword",
        "normalizer": "lowercase_normalizer"
      },
      "CNPFlex":{
        "type": "text"
      },
      "ClientType":{
        "type": "text"
      },
      "ClientCategory":{
        "type": "text"
      },
      "FirstName":{
        "type": "text",
        "fields": {
          "keyword":{
            "type": "keyword",
            "normalizer": "lowercase_normalizer"
          }
        }
      },
      "LastName":{
        "type": "text",
        "fields": {
          "keyword":{
            "type": "keyword",
            "normalizer": "lowercase_normalizer"
          }
        }
      },
      "CompanyName":{
        "type": "text",
        "fields": {
          "keyword":{
            "type": "keyword",
            "normalizer": "lowercase_normalizer"
          }
        }
      },
      "DateOfBirth":{
        "type": "date",
        "format": "dd.MM.yyyy"
      },
      "IDDocType":{
        "type": "text"
      },
      "IDSeries":{
        "type": "text"
      },
      "IDNumber":{
        "type": "text"
      },
      "IDIssueDate": {
        "type": "date",
        "format": "dd.MM.yyyy"
      },
      "IDExpiryDate":{
        "type": "date",
        "format": "dd.MM.yyyy"
      },
      "LegalForm":{
        "type": "text"
      },
      "CreatedDatePJ":{
        "type": "date",
        "format": "dd.MM.yyyy"
      },
      "ClientClosedDate": {
        "type": "date",
        "format": "dd.MM.yyyy"
      },
      "LastModifiedDate":{
        "type": "date",
        "format": "dd.MM.yyyy"
      },
      "ListID":{
        "type": "text"
      },
      "MobilePhone":{
        "type": "text"
      }
    }
  }
}
```

## Search Examples

Here are common search patterns you can use:

### 1. Search by Unique Identifier
Best for exact matches when you know the customer's unique ID:

```json
{
  "ClientUniqueIdentifier": "1900101223344"
}
```

### 2. Search by Name
Useful for finding customers when you have their name details:

```json
{
  "FirstName": "TestFirstName",
  "LastName": "Test Last Name"
}
```

### 3. Complex Search
Combine multiple fields for more precise results:

```json
{
  "FirstName": "TestFirstName",
  "DateOfBirth": "01.01.1990",
  "LegalForm": "PF"
}
```

## Response Format

The search response includes:

* **customers**: Array of matching customers (maximum 10 results)
* **hasMore**: Boolean indicating if there are more than 10 matches
* **error**: Error description if the request failed

### Example Response

Topic name example:
```
ro.flowx.updates.sandbox.customer.management.response
```

Response body example:
```json
"searchResults" : {
    "customers" : [ {
      "id" : "CL12345",
      "firstName" : "John Doe",
      "lastName" : "Doe",
      "birthDate" : "27.02.1982",
      "cui" : "1820227103865_84",
      "companyName" : "",
      "clientCategory" : "PF",
      "clientType" : "PF",
      "idSeries" : "RT",
      "idNumber" : "879948",
      "idDocType" : "CI",
      "idExpiryDate" : "27.02.2023",
      "legalForm" : "",
      "listId" : "4691602",
      "mobilePhone" : "0711111111",
      "attributes" : null,
      "type" : "PF"}],
    "hasMore" : false,
    "error" : null
  }
```

## Search Best Practices

1. **Start Specific**: Begin with unique identifiers when available
2. **Combine Fields**: Use multiple fields to narrow down results
3. **Date Format**: Always use the format "dd.MM.yyyy" for date fields
4. **Case Sensitivity**: Searches are case-insensitive due to the lowercase normalizer
5. **Results Limit**: Remember that results are limited to 10 entries per query